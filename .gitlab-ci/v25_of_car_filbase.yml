"v25-filbase: build lotus":
  extends: .build-snippet
  artifacts:
    name: "v25-filbase binaries"
    paths: [lotus, lotus-miner, lotus-worker]
  script:
    - make lotus lotus-miner lotus-worker
  only:
    refs:
      - v25_of_car_filbase
  # when: manual

"v25-filbase: build lotus (intel)":
  extends: .build-snippet
  tags: ["docker", "x86", "intel"]
  artifacts:
    name: "v25-filbase-intel binaries"
    paths: [lotus, lotus-miner, lotus-worker]
  script:
    - export RUSTFLAGS="-C target-cpu=native -g"
    - export FFI_BUILD_FROM_SOURCE=1
    - export FFI_USE_CUDA=1
    - export FFI_USE_GPU2=1
    - export FIL_PROOFS_USE_GPU_COLUMN_BUILDER=1
    - export FIL_PROOFS_USE_GPU_TREE_BUILDER=1
    - make lotus lotus-miner lotus-worker
  only:
    refs:
      - v25_of_car_filbase
  when: manual

"v25-filbase: build external binaries":
  extends: .build-snippet
  artifacts:
    name: "v25-filbase external binaries"
    paths: [lotus-shed, lotus-wallet, lotus-gateway, lotus-stats]
  script:
    - make lotus-shed lotus-wallet lotus-gateway lotus-stats
  only:
    refs:
      - v25_of_car_filbase
  when: manual

"v25-filbase: build lotus (2k)":
  extends: .build-snippet
  variables:
    GOFLAGS: "-tags=2k"
  artifacts:
    name: "v25-filbase-2k binaries"
    paths: [lotus-shed, lotus, lotus-miner, lotus-worker, lotus-seed]
  script:
    - make lotus-shed lotus lotus-miner lotus-worker lotus-seed
  only:
    refs:
      - v25_of_car_filbase
  when: manual

"v23-filbase: build external binaries (2k)":
  extends: .build-snippet
  variables:
    GOFLAGS: "-tags=2k"
  artifacts:
    name: "v23-filbase-2k external binaries"
    paths: [lotus-wallet, lotus-gateway, lotus-stats]
  script:
    - make lotus-wallet lotus-gateway lotus-stats
  only:
    refs:
      - v23_of_car_filbase
  when: manual
